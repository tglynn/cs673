import json
import os
import boto3

def lambda_handler(event, context):
    BUCKET_NAME = os.environ['BUCKET_NAME']
    client = boto3.client('s3')
    s3 = boto3.resource('s3')
    
    response = client.list_objects_v2(Bucket=BUCKET_NAME)
    s3_files = response['Contents']
    print(s3_files)

    data = {
        "name":[],
        "desc":[]
    }
    
    for x in range(len(s3_files)):
        
        # Skip directory objects
        if s3_files[x]['Size'] != 0:
            
            # Get name of file
            filename = s3_files[x]['Key']
            
            # Get object, then description
            desc = s3.Object(BUCKET_NAME, filename).metadata['desc']
            
            # print(filename, desc) # debug
            data['name'].append(filename)
            data['desc'].append(desc)

    return {
    "message": data
    #"message": json.dumps(data)
    }
    
